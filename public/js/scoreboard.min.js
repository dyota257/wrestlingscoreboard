function exportTableToCSV(e){console.log("Start exportTableToCSV");for(var t=[],a=$("table.results tr"),i=0;i<a.length;i++){for(var l=[],s=a[i].querySelectorAll("td, th"),r=0;r<s.length;r++)l.push(s[r].innerText);t.push(l.join(","))}downloadCSV(t.join("\n"),e),console.log("End exportTableToCSV")}function optionsWeight(e){e.length>0&&$("[name=weight]").css("visibility","visible"),$("select[name=weight]").html('<option value=""></option>');for(var t=0;t<e.length;t++){var a=e[t];$("select[name=weight]").html($("select[name=weight]").html()+'<option value="'+a+'kg">'+a+" kg</option>")}}function dropdownsCheckWhich(){const e=$("select[name=age]").val(),t=$("select[name=style]").val();var a="";a="GR"==t?"Senior Greco-Roman":"18-20 yrs"==e||"21yrs+"==e||e.indexOf("Senior")>0?"Senior Freestyle":"Junior Freestyle",e.indexOf("SP")>0&&(a="Exhibition: "+a);const i=[a,e];return i}function displayFlex(e){$(e).css("display","flex")}function displayNone(e){$(e).css("display","none")}function hide(e){$(e).css("visibility","hidden")}function unhide(e){$(e).css("visibility","visible")}function underline(e){$(e).css("text-decoration","underline")}function noDecorate(e){$(e).css("text-decoration","")}function proper(e){let t=e.slice(0,1).toUpperCase(),a=e.slice(1,e.length);return t+a}function next(){let e=$("[matchOrder]");matchOrder+1<e.length&&(matchOrder++,moveMatchOrder())}function prev(){0!=matchOrder&&(matchOrder--,moveMatchOrder())}function moveMatchOrder(){$("tr").removeClass("matchOrder"),updateNames(),$(`tr[matchorder='${matchOrder}']`).addClass("matchOrder")}function updateNames(){[{target:".firstName.red",dataLabel:"red_firstname"},{target:".lastName.red",dataLabel:"red_lastname"},{target:".clubName.red",dataLabel:"red_club"},{target:".firstName.blue",dataLabel:"blue_firstname"},{target:".lastName.blue",dataLabel:"blue_lastname"},{target:".clubName.blue",dataLabel:"blue_club"}].forEach(e=>{$(e.target).text(getThisRowFixtures(e.dataLabel))}),displayFlex("#playerInput"),[{target:"input#redFirstName",dataLabel:"red_firstname"},{target:"input#redLastName",dataLabel:"red_lastname"},{target:"input#redClubName",dataLabel:"red_club"},{target:"input#blueFirstName",dataLabel:"blue_firstname"},{target:"input#blueLastName",dataLabel:"blue_lastname"},{target:"input#blueClubName",dataLabel:"blue_club"}].forEach(e=>{$(e.target).val(getThisRowFixtures(e.dataLabel))})}function getThisRowFixtures(e){return $(`tr[matchOrder='${matchOrder}']>[data-label='${e}']`)[0].textContent.trim()}function warning(e){function t(){$(`.markerWarning.${e}`).append("â– "),playerX.warnings++}switch(e){case"red":playerX=playerRed,payerY=playerBlue;break;case"blue":playerX=playerBlue,payerY=playerRed}playerX.warnings<2?t():(t(),unhide("#announcevictory"),disqualification=e)}function setGame(){displayFlex("#playerInput")}function cancelConfirmGame(){displayNone("#playerInput")}function fixtures(){switch($("#fixturesTable").css("display")){case"flex":displayNone("#fixturesTable"),$("#fixtures").text("Fixtures ðŸ”½");break;case"none":displayFlex("#fixturesTable"),$("#fixtures").text("Fixtures ðŸ”¼")}}function setConfirmGame(){if(gametype=$("input[name=wrestlingStyle]:checked").val(),$(".middle").css("backgroundColor","black"),""==$("#blueFirstName").val()||""==$("#blueLastName").val()||""==$("#blueClubName").val()||""==$("#redFirstName").val()||""==$("#redLastName").val()||""==$("#redClubName").val())window.alert("Fill in all the names and game type!");else{displayNone("#playerInput"),displayNone("#fixturesTable"),setPhase(0),timerInit=60*$("input[name=matchTime]:checked").val(),timeRest=timeValue[0],$("#gameType").text(gameType),$("#timer").html(Math.floor(timerInit/60).toString()+":00"),$("#startTimer").html("â–¶"),$("#startTimer").prop("disabled",!1),timerOn=!1,shotClockTimerOn=!1,now=timerInit,phasesTime=[timerInit,timeRest,timerInit],playerBlue={...playerBlue,firstName:$("#blueFirstName").val(),lastName:$("#blueLastName").val(),clubName:$("#blueClubName").val()},playerRed={...playerRed,firstName:$("#redFirstName").val(),lastName:$("#redLastName").val(),clubName:$("#redClubName").val()},players=[playerBlue,playerRed],$(".blue.firstName").text(playerBlue.firstName),$(".blue.lastName").text(playerBlue.lastName),$(".blue.clubName").text(playerBlue.clubName),$(".red.firstName").text(playerRed.firstName),$(".red.lastName").text(playerRed.lastName),$(".red.clubName").text(playerRed.clubName),$(".popup input[name=time_start]").val(String((new Date).getHours()).padStart(2,"0")+":"+String((new Date).getMinutes()).padStart(2,"0")),reset(!0,!0,!0),hide("#announcevictory"),disqualification=!1,gameType.indexOf("Greco")>0?gameTypeWinScore=8:gameType.indexOf("Freestyle")>0&&(gameTypeWinScore=10);let e=$('td[data-label="id"]')[matchOrder].textContent.trim();$("input[name='matchID']").val(e);let t=window.location.pathname.split("/");$("input[name='mat']").val(t[2])}}function resetGame(){var e=window.confirm("Are you sure? This will reset all scores and reset the timer.");e&&(displayNone("#playerInput"),reset(!0,!0,!0,!0),hide("#announcevictory"),disqualification=!1,[".blue.firstName",".blue.lastName",".blue.clubName",".red.firstName",".red.lastName",".red.clubName"].forEach(e=>{$(e).text(e)}),$("#timer").html("0:00"))}function reset(e,t,a,i){e&&(playerBlue.score=0,playerRed.score=0,$(".score").text(0),noDecorate(".score")),t&&(playerBlue.warnings=0,playerRed.warnings=0,$("div.markerWarning").text("")),a&&hide(".shotclock"),i&&(i="",$("#gameType").text(i),gameTypeWinScore=0)}function setGameType(e){gameType=e,console.log("gameType: "+gameType)}function setMatchTime(e){matchTime=60*e,console.log("matchTime: "+matchTime)}function updateScore(e,t){let a;"blue"===e?a=0:"red"===e&&(a=1);let i=players[a];t<0&&0===i.score||""===gameType||(i.score+=t,$(`.score.${e}`).text(i.score),i.scoreHist.push(t),shotClockTimerOn&&(shotClockTimerOn=!1),"blue"===e?playerBlue=i:"red"===e&&(playerRed=i),criteria()),Math.abs(playerBlue.score-playerRed.score)>=gameTypeWinScore&&""!=gameType?unhide("#announcevictory"):hide("#announcevictory")}function criteria(){scoreRedMax=Math.max(...playerRed.scoreHist),scoreRedLast=playerRed.scoreHist[playerRed.scoreHist.length-1],scoreBlueMax=Math.max(...playerBlue.scoreHist),scoreBlueLast=playerBlue.scoreHist[playerBlue.scoreHist.length-1],playerRed.score==playerBlue.score?scoreRedMax>scoreBlueMax?underline(".red.score"):scoreRedMax<scoreBlueMax?underline(".blue.score"):scoreRedMax==scoreBlueMax&&(scoreRedLast>scoreBlueLast?underline(".red.score"):scoreRedLast<scoreBlueLast&&underline(".blue.score")):noDecorate(".score")}function airhorn(){new Audio("/sounds/airhorn.mp3").play()}function setPhase(e){$("#period").html("Period "+phases[e])}function secondsToClock(e){let t=new Date(0);return t.setSeconds(e),t.toISOString().substr(15,4)}function timerFlickerIcon(){let e="";e=timerOn?"â–¶":'<i class="fas fa-pause"></i>',$("#startTimer").html(e)}function startTimer(){window.location="#main-display",console.log("now: "+now),timerFlickerIcon(),!1===timerOn?(timerOn=!0,timer(now),!0===shotClockTimerOn&&(shotClockTimer(nowShotClock),shotClockPaused=!1),$(".middle").css("backgroundColor","black"),["#resetGameRow","#importArea","#playerInput","#fixturesTable","nav","#mainHeader"].forEach(e=>{displayNone(e)})):!0===timerOn&&(timerOn=!1,timer(now),$(".middle").css("backgroundColor","grey"),["#resetGameRow","nav","#mainHeader"].forEach(e=>{displayFlex(e)}))}function timer(e){let t=(new Date).getTime(),a=setInterval(function(){!0===timerOn&&(now=Math.ceil((1e3*e-((new Date).getTime()-t))/1e3),$("#timer").html(secondsToClock(now)),shotClockTimer()),now<=0&&!0===timerOn&&(phasePos++,phasePos<3?(new Audio("/sounds/airhorn.mp3").play(),setPhase(phasePos),startTimer(phasesTime[phasePos])):(new Audio("/sounds/airhorn.mp3").play(),console.log("it must be the end of the game, close things down"),$("#startTimer").prop("disabled",!0),$("#announcevictory").css("visibility","visible"),clearInterval(a))),(now<=0||!1===timerOn)&&(clearInterval(a),now=e)},1e3)}function shotClockTimer(e){(new Date).getTime();if(shotClockTimerOn&&(nowShotClock=now-nowOffset,$(".shotclock").html(secondsToClock(nowShotClock))),!shotClockTimerOn&&nowShotClock>0&&($(".shotclock").css("visibility","hidden"),shotClockTimerOn=!1,shotClockPlayer=null),nowShotClock<=0&&shotClockTimerOn){switch($(".shotclock").css("visibility","hidden"),shotClockPlayer){case"blue":redScoreUpdate(1);break;case"red":blueScoreUpdate(1)}shotClockTimerOn=!1,shotClockPlayer=null}(now<=0||!timerOn)&&shotClockTimerOn&&(console.log(`Timer stopped at: ${nowShotClock}`),clearInterval(interval),shotClockPaused=!0)}function announceVictory(){if("red"===disqualification)victory("blue","disqualification");else if("blue"===disqualification)victory("red","disqualification");else{let e=Math.max(playerBlue.score,playerRed.score),t=players.find(t=>t.score===e).side;Math.abs(playerRed.score-playerBlue.score)>=10?victory(t,"technical superiority"):victory(t,"points")}timerOn&&startTime(now),$("#announcevictory").css("visibility","hidden")}function victory(e,t){switch($(".popup").css("display","flex"),$(".popup").css("height",document.body.clientHeight),t){case"fall":classification="VFA 5:0";break;case"technical superiority":classification=0==playerRed.score||0==playerBlue.score?"VSU 4:0":"VSU1 4:1";break;case"points":classification=0==playerRed.score||0==playerBlue.score?"VPO 3:0":"VPO1 3:1";break;case"disqualification":classification="VCA 5:0"}let a=classification.split(" ")[1].split(":"),i=a[0],l=a[1];var s="",r="",n="";if("draw"==e)r="Draw!",n="black";else{let a=players.find(t=>t.side===e).firstName,i=players.find(t=>t.side===e).lastName;s=`${a} ${i}`,r=`${s} wins by ${t}!`,n=e}switch($(".popup-text").text(r),$(".popup-content").css("background",n),$(".popup input[name=tournamentId]").val($("#tournamentId").text()),$(".popup input[name=matchID]").val(),$(".popup input[name=mat]").val($("select[name=mat]").val()),$(".popup input[name=red]").val(playerRed.firstName+" "+playerRed.lastName),$(".popup input[name=blue]").val(playerBlue.firstName+" "+playerBlue.lastName),$(".popup input[name=red_club]").val(playerRed.clubName),$(".popup input[name=blue_club]").val(playerBlue.clubName),$(".popup input[name=red_score]").val(playerRed.score),$(".popup input[name=blue_score]").val(playerBlue.score),$(".popup input[name=winner]").val(e),e){case"red":$(".popup input[name=class_points_red]").val(i),$(".popup input[name=class_points_blue]").val(l);break;case"blue":$(".popup input[name=class_points_red]").val(l),$(".popup input[name=class_points_blue]").val(i)}$(".popup input[name=age]").val($("select[name=age]").val()),$(".popup input[name=gender]").val($("select[name=gender]").val().slice(0,1)),"Greco-Roman"===$("select[name=style]").val()?$(".popup input[name=style]").val("GR"):$(".popup input[name=style]").val("FS"),$(".popup input[name=weight]").val($("select[name=weight]").val()),$(".popup input[name=time_end]").val(String((new Date).getHours()).padStart(2,"0")+":"+String((new Date).getMinutes()).padStart(2,"0")),$(".popup input[name=time_clock]").val($("#period").text()+", "+$("#timer").text())}$("#download").click(function(){console.log("Click download."),exportTableToCSV("numbers.csv")});const url=window.location.pathname.split("/"),mat=url[url.length-1];$(`select[name=mat]>option[value='${mat}']`).attr("selected",!0);const categories={"6-7 yrs":[19,23,27,35,42,53,66,73,"73+"],"8-9 yrs":[23,27,35,42,53,66,73,"73+"],"10-11 yrs":[23,27,35,42,53,66,73,85,"85+"],"12-13 yrs":{Female:[33,37,44,50,55,62,73,85,"85+"],Male:[35,41,48,55,62,69,75,89,"89+"]},"14-15 yrs":{Female:[35,40,45,50,55,60,65,70,"70+"],Male:[35,42,49,56,63,70,78,89,"89+"]},"16-17 yrs":{Female:[40,43,49,56,61,65,69,73,"73+"],Male:[48,55,62,69,74,86,92,110,"110+"]},"18-20 yrs":{Female:[50,53,57,62,68,76,85,"85+"],Male:{FS:[57,65,74,79,86,92,97,125,"125+"],GR:[60,67,77,87,97,130,"130+"]}},"21yrs+":{Female:[50,53,57,62,68,76,85,"85+"],Male:{FS:[57,65,74,79,86,92,97,125,"125+"],GR:[60,67,77,87,97,130,"130+"]}}};let ageDiv="",arWeight=[],genderDiv="",styleDiv="";$("[name=gender]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("[name=weight]").css("visibility","hidden"),$("select[name=age]").val(""),$("select[name=gender]").val(""),$("select[name=style]").val(""),$("select[name=weight]").val(""),$("select[name=age]").change(()=>{$("[name=gender]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("[name=weight]").css("visibility","hidden"),$("select[name=gender]").val(""),$("select[name=style]").val(""),$("select[name=weight]").val(""),arWeight=[],ageDiv=$("select[name=age]").val(),"6-7 yrs"==ageDiv||"8-9 yrs"==ageDiv||"10-11 yrs"==ageDiv?(arWeight=categories[ageDiv],optionsWeight(arWeight)):$("[name=gender]").css("visibility","visible")}),$("select[name=gender]").change(()=>{$("[name=weight]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("select[name=style]").val(""),$("select[name=weight]").val(""),arWeight=[],genderDiv=$("select[name=gender]").val(),"12-13 yrs"==ageDiv||"14-15 yrs"==ageDiv||"16-17 yrs"==ageDiv||"Female"==genderDiv&&("18-20 yrs"==ageDiv||"21yrs+"==ageDiv)?(arWeight=categories[ageDiv][genderDiv],optionsWeight(arWeight)):("Male"!=genderDiv||"18-20 yrs"!=ageDiv&&"21yrs+"!=ageDiv)&&"SP Senior"!=ageDiv||$("[name=style]").css("visibility","visible")}),$("select[name=style]").change(()=>{$("select[name=weight]").css("visibility","hidden"),$("select[name=weight]").val(""),arWeight=[],styleDiv=$("select[name=style]").val(),arWeight=categories[ageDiv][genderDiv][styleDiv],optionsWeight(arWeight)});var matchOrder=0;updateNames(0),$("tr[matchOrder='0']").addClass("matchOrder");class Player{constructor(e,t,a,i,l,s,r,n){this.side=e,this.firstName=t,this.lastName=a,this.clubName=i,this.score=l,this.scoreHist=s,this.warnings=r,this.shotClock=n}}let playerBlue=new Player("blue","blueFirstName","blueLastName","blueClubName",0,[],0,!1),playerRed=new Player("red","redFirstName","redLastName","redClubName",0,[],0,!1),players=[playerBlue,playerRed],side="red";players.find(e=>e.side===side).firstName;let gameType="",gameTypeWinScore=0,disqualification="",timerOn=!1,timerInit=0,timerPause=0,now=0,nowShotClock=0,matchTime=0;const phases=["1","2"],timeValue=[30,120,180];let phasePos=0,phasesTime=[0,0,0],nowOffset=0;const shotClockTime=30;let shotClockTimerOn=!1,shotClockPaused=!1,shotClockPlayer=null;$(".score.blue").text(playerBlue.score),$(".score.red").text(playerRed.score),$("#startTimer").prop("disabled",!0),$("button").click(function(){this.blur();var e=this.parentElement.className.split(" ")[0];let t=this.id;switch(console.log("buttonId: "+t),console.log("side: "+e),console.log("parentElement.className: "+this.parentElement.className),this.parentElement.className){case`${e} penalty`:switch(this.className){case"shotclockbtn":if(shotClockTimerOn)break;if(now<shotClockTime)break;timerOn?shotClockTimerOn||(unhide(`.${e}.shotclock`),shotClockPlayer=players.find(t=>t.side===e).side,shotClockTimerOn=!0,nowOffset=now-30):unhide(`.${e}.shotclock`)}}}),$(".close").click(function(){displayNone(".popup"),unhide("#announcevictory")});const scoresMap=[-1,1,2,4,5];$(document).keydown(e=>{const t=[72,74,75,76,59],a=[71,70,68,83,65];let i=0;32!=e.keyCode&&1==timerOn&&(t.includes(e.keyCode)&&(i=scoresMap[t.indexOf(e.keyCode)],updateScore("blue",i)),a.includes(e.keyCode)&&(i=scoresMap[a.indexOf(e.keyCode)],updateScore("red",i)))}),$(document).keydown(e=>{32==e.keyCode&&0==$("#startTimer").prop("disabled")&&"none"===$("#playerInput").css("display")&&(e.preventDefault(),startTimer(),console.log("timerInit: "+timerInit),console.log(now))});var classification="";