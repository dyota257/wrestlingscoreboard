function exportTableToCSV(e){console.log("Start exportTableToCSV");for(var t=[],a=$("table.results tr"),s=0;s<a.length;s++){for(var r=[],l=a[s].querySelectorAll("td, th"),i=0;i<l.length;i++)r.push(l[i].innerText);t.push(r.join(","))}downloadCSV(t.join("\n"),e),console.log("End exportTableToCSV")}function optionsWeight(e){e.length>0&&$("[name=weight]").css("visibility","visible"),$("select[name=weight]").html('<option value=""></option>');for(var t=0;t<e.length;t++){var a=e[t];$("select[name=weight]").html($("select[name=weight]").html()+'<option value="'+a+'kg">'+a+" kg</option>")}}function dropdownsCheckWhich(){const e=$("select[name=age]").val(),t=$("select[name=style]").val();var a="";a="Greco-Roman"==t?"Senior Greco-Roman":"18-20 yrs"==e||"21yrs+"==e?"Senior Freestyle":-1===e.indexOf("min")?"Junior Freestyle":"2min"===e?"Exhibition: 2 mins":"Exhibition: 3 mins";const s=[a,e];return s}function updateNames(e){$(".firstName.red").text($(`tr[matchOrder='${e}']>[data-label='red_firstname']`)[0].textContent.trim()),$(".lastName.red").text($(`tr[matchOrder='${e}']>[data-label='red_lastname']`)[0].textContent.trim()),$(".clubName.red").text($(`tr[matchOrder='${e}']>[data-label='red_club']`)[0].textContent.trim()),$(".firstName.blue").text($(`tr[matchOrder='${e}']>[data-label='blue_firstname']`)[0].textContent.trim()),$(".lastName.blue").text($(`tr[matchOrder='${e}']>[data-label='blue_lastname']`)[0].textContent.trim()),$(".clubName.blue").text($(`tr[matchOrder='${e}']>[data-label='blue_club']`)[0].textContent.trim()),$("#playerInput").css("display","flex"),$("input#redFirstName").val($(`tr[matchOrder='${e}']>[data-label='red_firstname']`)[0].textContent.trim()),$("input#redLastName").val($(`tr[matchOrder='${e}']>[data-label='red_lastname']`)[0].textContent.trim()),$("input#redClubName").val($(`tr[matchOrder='${e}']>[data-label='red_club']`)[0].textContent.trim()),$("input#blueFirstName").val($(`tr[matchOrder='${e}']>[data-label='blue_firstname']`)[0].textContent.trim()),$("input#blueLastName").val($(`tr[matchOrder='${e}']>[data-label='blue_lastname']`)[0].textContent.trim()),$("input#blueClubName").val($(`tr[matchOrder='${e}']>[data-label='blue_club']`)[0].textContent.trim())}function reset(e,t,a,s){e&&(playerBlue.score=0,playerRed.score=0,$(".score").text(0),$(".score").css("text-decoration","none")),t&&(playerBlue.warnings=0,playerRed.warnings=0,$("div.markerWarning").text("")),a&&$(".shotclock").css("visibility","hidden"),s&&(s="",$("#gameType").text(s),gameTypeWinScore=0)}function updateScore(e,t){let a;"blue"===e?a=0:"red"===e&&(a=1);let s=players[a];t<0&&0===s.score||""===gameType||(s.score+=t,$(`.score.${e}`).text(s.score),s.scoreHist.push(t),shotClockTimerOn&&(shotClockTimerOn=!1),"blue"===e?playerBlue=s:"red"===e&&(playerRed=s),criteria()),Math.abs(playerBlue.score-playerRed.score)>=gameTypeWinScore&&""!=gameType?$("#announcevictory").css("visibility","visible"):$("#announcevictory").css("visibility","hidden")}function criteria(){scoreRedMax=Math.max(...playerRed.scoreHist),scoreRedLast=playerRed.scoreHist[playerRed.scoreHist.length-1],scoreBlueMax=Math.max(...playerBlue.scoreHist),scoreBlueLast=playerBlue.scoreHist[playerBlue.scoreHist.length-1],playerRed.score==playerBlue.score?scoreRedMax>scoreBlueMax?$(".red.score").css("text-decoration","underline"):scoreRedMax<scoreBlueMax?$(".blue.score").css("text-decoration","underline"):scoreRedMax==scoreBlueMax&&(scoreRedLast>scoreBlueLast?$(".red.score").css("text-decoration","underline"):scoreRedLast<scoreBlueLast&&$(".blue.score").css("text-decoration","underline")):$(".score").css("text-decoration","")}function setPhase(e){$("#period").html("Period "+phases[e])}function secondsToClock(e){let t=new Date(0);return t.setSeconds(e),t.toISOString().substr(15,4)}function startTimer(e){!1===timerOn?($("#startTimer").html('<i class="fas fa-pause"></i>'),timerOn=!0,timer(e),!0===shotClockTimerOn&&(shotClockTimer(nowShotClock),shotClockPaused=!1),$(".middle").css("backgroundColor","black"),$("#resetGameRow").css("display","none"),$("#importArea").css("display","none"),$("#playerInput").css("display","none"),$("#fixturesTable").css("display","none")):!0===timerOn&&($("#startTimer").html("▶"),timerOn=!1,timer(e),$(".middle").css("backgroundColor","grey"),$("#resetGameRow").css("display","flex"))}function timer(e){let t=(new Date).getTime();var a=setInterval(function(){if(!0===timerOn&&(now=Math.ceil((1e3*e-((new Date).getTime()-t))/1e3),$("#timer").html(secondsToClock(now)),shotClockTimer()),now<=0&&!0===timerOn)if(new Audio("/sounds/airhorn.mp3").play(),phasePos++,phasePos<3)setPhase(phasePos),startTimer(phasesTime[phasePos]);else{$("#startTimer").prop("disabled",!0);var s=(scoreBlue-scoreRed)/Math.abs(scoreBlue-scoreRed);switch(s){case 1:victory("blue","points");break;case-1:victory("red","points");break;default:victory("draw","technical superiority"),console.log("Outcome is draw")}clearInterval(a)}(now<=0||!1===timerOn)&&(clearInterval(a),now=e)},1e3)}function shotClockTimer(e){(new Date).getTime();if(shotClockTimerOn&&(nowShotClock=now-nowOffset,$(".shotclock").html(secondsToClock(nowShotClock))),!shotClockTimerOn&&nowShotClock>0&&($(".shotclock").css("visibility","hidden"),shotClockTimerOn=!1,shotClockPlayer=null),nowShotClock<=0&&shotClockTimerOn){switch($(".shotclock").css("visibility","hidden"),shotClockPlayer){case"blue":redScoreUpdate(1);break;case"red":blueScoreUpdate(1)}shotClockTimerOn=!1,shotClockPlayer=null}(now<=0||!timerOn)&&shotClockTimerOn&&(console.log(`Timer stopped at: ${nowShotClock}`),clearInterval(interval),shotClockPaused=!0)}function victory(e,t){switch($(".popup").css("display","flex"),$(".popup").css("height",document.body.clientHeight),startTimer(now),t){case"fall":classification="VFA 5:0";break;case"technical superiority":classification=0==playerRed.score||0==playerBlue.score?"VSU 4:0":"VSU1 4:1";break;case"points":classification=0==playerRed.score||0==playerBlue.score?"VPO 3:0":"VPO1 3:1"}let a=classification.split(" ")[1].split(":"),s=a[0],r=a[1];var l="",i="",n="";if("draw"==e)i="Draw!",n="black";else{let a=players.find(t=>t.side===e).firstName,s=players.find(t=>t.side===e).lastName;l=`${a} ${s}`,i=`${l} wins by ${t}!`,n=e}switch($(".popup-text").text(i),$(".popup-content").css("background",n),$(".popup input[name=tournamentId]").val($("#tournamentId").text()),$(".popup input[name=matchID]").val(),$(".popup input[name=mat]").val($("select[name=mat]").val()),$(".popup input[name=red]").val(playerRed.firstName+" "+playerRed.lastName),$(".popup input[name=blue]").val(playerBlue.firstName+" "+playerBlue.lastName),$(".popup input[name=winner]").val(e),e){case"red":$(".popup input[name=class_points_red]").val(s),$(".popup input[name=class_points_blue]").val(r);break;case"blue":$(".popup input[name=class_points_red]").val(r),$(".popup input[name=class_points_blue]").val(s)}$(".popup input[name=age]").val($("select[name=age]").val()),$(".popup input[name=gender]").val($("select[name=gender]").val()),$(".popup input[name=style]").val($("select[name=style]").val()),$(".popup input[name=weight]").val($("select[name=weight]").val()),$(".popup input[name=time_end]").val(String((new Date).getHours()).padStart(2,"0")+":"+String((new Date).getMinutes()).padStart(2,"0")),$(".popup input[name=time_clock]").val($("#period").text()+", "+$("#timer").text());var o=$("table.results>tbody");console.log(o);var c=`\n        <td>${playerBlue.firstName} ${playerBlue.lastName}</td>\n        <td>${playerRed.firstName} ${playerRed.lastName}</td>\n        <td>${playerBlue.score}</td>\n        <td>${playerRed.score}</td>\n        <td>${l}</td>\n        <td>${t}</td>\n        <td>${classification}</td>`;o.html(o.html()+c)}$("#download").click(function(){console.log("Click download."),exportTableToCSV("numbers.csv")});const url=window.location.href,mat=url.slice(url.length-1);$(`select[name=mat]>option[value='${mat}']`).attr("selected",!0);const categories={"6-7 yrs":[19,23,27,35,42,53,66,73,"73+"],"8-9 yrs":[23,27,35,42,53,66,73,"73+"],"10-11 yrs":[23,27,35,42,53,66,73,85,"85+"],"12-13 yrs":{Female:[33,37,44,50,55,62,73,85,"85+"],Male:[35,41,48,55,62,69,75,89,"89+"]},"14-15 yrs":{Female:[35,40,45,50,55,60,65,70,"70+"],Male:[35,42,49,56,63,70,78,89,"89+"]},"16-17 yrs":{Female:[40,43,49,56,61,65,69,73,"73+"],Male:[48,55,62,69,74,86,92,110,"110+"]},"18-20 yrs":{Female:[50,53,57,62,68,76,85,"85+"],Male:{Freestyle:[57,65,74,79,86,92,97,125,"125+"],"Greco-Roman":[60,67,77,87,97,130,"130+"]}},"21yrs+":{Female:[50,53,57,62,68,76,85,"85+"],Male:{Freestyle:[57,65,74,79,86,92,97,125,"125+"],"Greco-Roman":[60,67,77,87,97,130,"130+"]}}};let ageDiv="",arWeight=[],genderDiv="",styleDiv="";$("[name=gender]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("[name=weight]").css("visibility","hidden"),$("select[name=age]").val(""),$("select[name=gender]").val(""),$("select[name=style]").val(""),$("select[name=weight]").val(""),$("select[name=age]").change(()=>{$("[name=gender]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("[name=weight]").css("visibility","hidden"),$("select[name=gender]").val(""),$("select[name=style]").val(""),$("select[name=weight]").val(""),arWeight=[],ageDiv=$("select[name=age]").val(),"6-7 yrs"==ageDiv||"8-9 yrs"==ageDiv||"10-11 yrs"==ageDiv?(arWeight=categories[ageDiv],optionsWeight(arWeight)):-1===ageDiv.indexOf("min")&&$("[name=gender]").css("visibility","visible")}),$("select[name=gender]").change(()=>{$("[name=weight]").css("visibility","hidden"),$("[name=style]").css("visibility","hidden"),$("select[name=style]").val(""),$("select[name=weight]").val(""),arWeight=[],genderDiv=$("select[name=gender]").val(),"12-13 yrs"==ageDiv||"14-15 yrs"==ageDiv||"16-17 yrs"==ageDiv||"Female"==genderDiv&&("18-20 yrs"==ageDiv||"21yrs+"==ageDiv)?(arWeight=categories[ageDiv][genderDiv],optionsWeight(arWeight)):"Male"!=genderDiv||"18-20 yrs"!=ageDiv&&"21yrs+"!=ageDiv||$("[name=style]").css("visibility","visible")}),$("select[name=style]").change(()=>{$("select[name=weight]").css("visibility","hidden"),$("select[name=weight]").val(""),arWeight=[],styleDiv=$("select[name=style]").val(),arWeight=categories[ageDiv][genderDiv][styleDiv],optionsWeight(arWeight)});var matchOrder=0,pairing=[],table=[],blueFirstName="",blueLastName="",blueClubName="",redFirstName="",redLastName="",redClubName="",raw="",rows=[],tablePage=$("table[name=list]");$("tr[matchOrder='0']").addClass("matchOrder"),$("button#next").click(function(){table=$("[matchOrder]"),matchOrder+1<table.length&&($("tr").removeClass("matchOrder"),matchOrder++,updateNames(matchOrder),$("tr[matchorder='"+matchOrder+"']").addClass("matchOrder"))}),$("button#prev").click(function(){0!=matchOrder&&($("tr").removeClass("matchOrder"),matchOrder--,updateNames(matchOrder),$("tr[matchorder='"+matchOrder+"']").addClass("matchOrder"))});class Player{constructor(e,t,a,s,r,l,i,n){this.side=e,this.firstName=t,this.lastName=a,this.clubName=s,this.score=r,this.scoreHist=l,this.warnings=i,this.shotClock=n}}let playerBlue=new Player("blue","blueFirstName","blueLastName","blueClubName",0,[],0,!1),playerRed=new Player("red","redFirstName","redLastName","redClubName",0,[],0,!1),players=[playerBlue,playerRed],side="red";players.find(e=>e.side===side).firstName;var gameType="",gameTypeWinScore=0,timerOn=!1,timerInit=0,timerPause=0,now=0;let nowShotClock=0;const phases=["1","rest","2"],timeRest=30;var phasePos=0,phasesTime=[0,0,0];let nowOffset=0;const shotClockTime=30;let shotClockTimerOn=!1,shotClockPaused=!1,shotClockPlayer=null;const scoresMap=[-1,1,2,4,5];$(".score.blue").text(playerBlue.score),$(".score.red").text(playerRed.score),$("#startTimer").prop("disabled",!0),$(document).keydown(e=>{const t=[72,74,75,76,59],a=[71,70,68,83,65];if(32==e.keyCode&&0==$("#startTimer").prop("disabled")&&"none"===$("#playerInput").css("display")&&(e.preventDefault(),startTimer(now),console.log("timerInit: "+timerInit)),32!=e.keyCode&&1==timerOn){if(t.includes(e.keyCode)){var s=scoresMap[t.indexOf(e.keyCode)];updateScore("blue",s)}if(a.includes(e.keyCode)){s=scoresMap[a.indexOf(e.keyCode)];updateScore("red",s)}}}),$("button").click(function(){this.blur(),"airhorn"===this.id&&new Audio("/sounds/airhorn.mp3").play();var e=this.parentElement.className.split(" ")[0];let t=this.id;console.log("buttonId: "+t);var a=scoresMap[this.value];switch(console.log("side: "+e),console.log("parentElement.className: "+this.parentElement.className),this.parentElement.className){case`${e} buttonsRow`:updateScore(e,a);break;case`${e} penalty`:switch(this.className){case"warning":players[playerNumber].warnings<2?($(`.markerWarning.${e}`).text($(`.markerWarning.${e}`).text()+"■"),players[playerNumber].warnings++):victory(players[Math.abs(playerNumber-1)].side,"disqualification");break;case"shotclockbtn":if(shotClockTimerOn)break;if(now<shotClockTime)break;timerOn?shotClockTimerOn||($(`.${e}.shotclock`).css("visibility","visible"),shotClockPlayer=players.find(t=>t.side===e).side,shotClockTimerOn=!0,nowOffset=now-30):$(`.${e}.shotclock`).css("visibility","visible")}break;case`${e} pin`:victory(e,"fall")}if("import"===this.id&&$("#importArea").css("display","flex"),"fixtures"===this.id)switch($("#fixturesTable").css("display")){case"flex":$("#fixturesTable").css("display","none");break;case"none":$("#fixturesTable").css("display","flex")}if("announcevictory"===this.id){let e=Math.max(playerBlue.score,playerRed.score),t=players.find(t=>t.score===e).side;victory(t,"technical superiority"),$("#announcevictory").css("visibility","hidden")}if("setGame"===this.id&&$("#playerInput").css("display","flex"),"cancelConfirmGame"===this.id&&$("#playerInput").css("display","none"),"setConfirmGame"===this.id)if(gameType="",gameType=dropdownsCheckWhich()[0]+", "+dropdownsCheckWhich()[1]+", "+$("select[name=weight]").val(),$(".middle").css("backgroundColor","black"),""!=$("#blueFirstName").val()&&""!=$("#blueLastName").val()&&""!=$("#blueClubName").val()&&""!=$("#redFirstName").val()&&""!=$("#redLastName").val()&&""!=$("#redClubName").val()&&""!=$("select[name=weight]").val()||-1!==ageDiv.indexOf("min")){$("#playerInput").css("display","none"),$("#fixturesTable").css("display","none"),phasePos=0,setPhase(phasePos),timerInit="Junior Freestyle"==dropdownsCheckWhich()[0]||"Exhibition: 2 mins"==dropdownsCheckWhich()[0]?120:180,$("#gameType").text(gameType),$("#timer").html(Math.floor(timerInit/60).toString()+":00"),$("#startTimer").html("▶"),$("#startTimer").prop("disabled",!1),timerOn=!1,shotClockTimerOn=!1,now=timerInit,phasesTime=[timerInit,timeRest,timerInit],playerBlue={...playerBlue,firstName:$("#blueFirstName").val(),lastName:$("#blueLastName").val(),clubName:$("#blueClubName").val()},playerRed={...playerRed,firstName:$("#redFirstName").val(),lastName:$("#redLastName").val(),clubName:$("#redClubName").val()},players=[playerBlue,playerRed],$(".blue.firstName").text(playerBlue.firstName),$(".blue.lastName").text(playerBlue.lastName),$(".blue.clubName").text(playerBlue.clubName),$(".red.firstName").text(playerRed.firstName),$(".red.lastName").text(playerRed.lastName),$(".red.clubName").text(playerRed.clubName),$(".popup input[name=time_start]").val(String((new Date).getHours()).padStart(2,"0")+":"+String((new Date).getMinutes()).padStart(2,"0")),reset(!0,!0,!0),gameType.indexOf("Greco")>0?gameTypeWinScore=8:gameType.indexOf("Freestyle")>0&&(gameTypeWinScore=10);let e=$('td[data-label="id"]')[matchOrder].textContent.trim();$("input[name='matchID']").val(e);let t=window.location.pathname.split("/");$("input[name='mat']").val(t[2])}else window.alert("Fill in all the names and game type!");if("resetGame"===this.id){var s=window.confirm("Are you sure? This will reset all scores and reset the timer.");s&&($("#playerInput").css("display","none"),reset(!0,!0,!0,!0),$(".blue.firstName").text("blueFirstName"),$(".blue.lastName").text("blueLastName"),$(".blue.clubName").text("blueClubName"),$(".red.firstName").text("redFirstName"),$(".red.lastName").text("redLastName"),$(".red.clubName").text("redClubName"),$("#timer").html("0:00"))}"startTimer"===this.id&&(window.location.href="#main-display",startTimer(now))}),$(".close").click(function(){$(".popup").css("display","none")});var classification="";